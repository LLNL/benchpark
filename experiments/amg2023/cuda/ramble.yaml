ramble:
  config:
    deprecated: true
    spack_flags:
      install: '--add --keep-stage'
      concretize: '-U -f'
  applications:
    amg2023:
      workloads:
        problem1:
          variables:
            n_ranks: '{processes_per_node} * {n_nodes}'
            p: 2
            px: '{p}'
            py: '{p}'
            pz: '{p}'
            n: ['10', '20']
            nx: '{n}'
            ny: '{n}'
            nz: '{n}'
            experiment_setup: ''
            gtl: ['gtl', 'nogtl']
            gtlflag: ['-M"-gpu"', '']
          experiments:
            # because MPS only works for cuda<=v10
            amg2023_cuda_10_problem1_{gtl}_{n_nodes}_{px}_{py}_{pz}_{nx}_{ny}_{nz}:
              variables:
                experiment_setup: '/usr/tcetmp/bin/enable_mps'
                env_name: amg2023-cuda-10
                processes_per_node: '8'
                n_nodes: '1'
              matrices:
                - size:
                  - n
            amg2023_cuda_default_problem1_{gtl}_{n_nodes}_{px}_{py}_{pz}_{nx}_{ny}_{nz}:
              variables:
                env_name: amg2023-cuda-default
                processes_per_node: ['4', '2']
                n_nodes: ['2', '4']
              zips:
                gtl_info:
                - gtl
                - gtlflag
              matrices:
                - size:
                  - n
                  - gtl_info
  spack:
    concretized: true
    packages:
      hypre-cuda-10:
        spack_spec: hypre@2.28.0 +mpi+cuda+mixedint cuda_arch={cuda_arch} ^cuda@{cuda10_version}
        compiler: compiler-cuda10
      amg2023-cuda-10:
        spack_spec: amg2023@develop +mpi+cuda ^cuda@{cuda10_version}
        compiler: compiler-cuda10
      hypre-cuda-default:
        spack_spec: hypre@2.28.0 +mpi+cuda+mixedint cuda_arch={cuda_arch} ^cuda@{default_cuda_version}
        compiler: default-compiler
      amg2023-cuda-default:
        spack_spec: amg2023@develop +mpi+cuda ^cuda@{default_cuda_version}
        compiler: default-compiler
    environments:
      amg2023-cuda-10:
        packages:
        - cublas-cuda-10
        - lapack
        - default-mpi
        - hypre-cuda-10
        - amg2023-cuda-10
      amg2023-cuda-default:
        packages:
        - cublas-cuda-default
        - lapack
        - default-mpi
        - hypre-cuda-default
        - amg2023-cuda-default
